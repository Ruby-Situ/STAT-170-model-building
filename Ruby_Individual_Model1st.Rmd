---
name: "Ruby Situ"
title: "week7final"
output: html_document
date: "2025-11-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
```

```{r}
#data <- read.csv("mergeddata.csv")
data <- read.csv("/Users/blubb/Desktop/170 files/mergeddata.csv")

set.seed(58)    #seed 58
n <- nrow(data)
train_index <- sample(1:n, size = 0.7 * n)
train_data <- data[train_index, ]
test_data  <- data[-train_index, ]

model1 <- lm(totalDisasters ~ PPM + aveMonthSeaTemp  + avg_surfacePressure+avg_saePressure+ Anomaly+ avg_cng_sealevel, data = train_data)  
summary(model1)
```
I can see that everything is significant except for PPM and avg_cng_sealevel.The R^2 is low however the overall model is still very significant. 



```{r}
cor(train_data[, c("totalDisasters", "PPM", "aveMonthSeaTemp", "avg_saePressure", "Anomaly", "avg_cng_sealevel")])
```

```{r}
car::vif(model1)

```

Due to multicollinearity  seen in both the VIF and the correlation matrix I will remove the avg_surfacePressure variable and try out transformations to get better results. 


```{r}

modelTesting <- lm(totalDisasters ~ PPM + aveMonthSeaTemp +avg_saePressure+ Anomaly+ avg_cng_sealevel + I(PPM^2) + I(aveMonthSeaTemp^2) + I(avg_saePressure^2) + I(Anomaly^2) + I(avg_cng_sealevel^2), data = train_data)

summary(modelTesting)
car::vif(modelTesting, type = 'predictor')

#second round of testing
modelTesting2 <- lm(totalDisasters ~ PPM + aveMonthSeaTemp +avg_saePressure+ Anomaly+ avg_cng_sealevel + PPM*avg_cng_sealevel + PPM*avg_saePressure + PPM*Anomaly + PPM*aveMonthSeaTemp + avg_cng_sealevel*aveMonthSeaTemp, data = train_data)

summary(modelTesting2)
car::vif(modelTesting2, type = 'predictor')
```
I can see that I(avg_cng_sealevel^2) and I(PPM^2) are significant and increased the R^2 a good amount. I also see that PPM * avg_cng_sealevel is significant. I will apply these changes to model 2. 

```{r}
model2 <- lm(totalDisasters ~ PPM + aveMonthSeaTemp +avg_saePressure+ Anomaly+ avg_cng_sealevel + I(PPM^2) + I(avg_cng_sealevel^2) + PPM * avg_cng_sealevel, data = train_data)

summary(model2)
car::vif(model2, type = "predictor")
```

I also see that the multicollinearity problem has been solved by making these changes. 

```{r}
par(mfrow = c(2,2))
plot(model2)

ggplot(data = train_data, aes(x = model2$residuals)) +
    geom_histogram(fill = "lightpink") +
    labs(title = "Histogram of Residuals", x = "Residuals")

```
The histogram of residuals looks pretty normal (maybe the tiniest bit of right skewing) and the scale-location plot also looks pretty normal with no obvious pattern visible meaning the variance should be constant and therefore not have heteroscedasticity. The QQ plot also appears to be pretty well in line with the straight line and there could be potential outliers just looking at the tail of the plot, there's a few points that stray away but nothing extreme. The residuals vs fitted plot does not show any obvious pattern of curving or u shapes so we can assume this is a linear pattern. 


```{r}
pred_test <- predict(model2, newdata = test_data)
RMSE <- sqrt(mean((test_data$totalDisasters - pred_test)^2))
RMSE

testR2 <- cor(test_data$totalDisasters, pred_test)^2
testR2
```
The R^2 I got from model2 is almost the same as the one from the test data meaning that there shouldn't be much over or underfitting. The RMSE seems a little high but probably not enough to be a concern. 














